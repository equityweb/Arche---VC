<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYC Startup Funding Tracker</title>
    <meta name="description" content="Real-time data on New York City startup funding rounds">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fafafa;
            color: #333;
            line-height: 1.5;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e1e5e9;
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .last-updated {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            text-align: center;
        }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: #2563eb;
            display: block;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        select, input {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .table-container {
            background: white;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f8fafc;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            color: #374151;
            border-bottom: 1px solid #e1e5e9;
        }

        td {
            padding: 16px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 14px;
        }

        tr:hover {
            background: #f8fafc;
        }

        .company-name {
            font-weight: 600;
            color: #1a1a1a;
        }

        .company-website {
            color: #2563eb;
            text-decoration: none;
            font-size: 12px;
            display: block;
            margin-top: 2px;
        }

        .company-website:hover {
            text-decoration: underline;
        }

        .funding-amount {
            font-weight: 600;
            color: #059669;
        }

        .round-type {
            background: #eff6ff;
            color: #1d4ed8;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .investors {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .refresh-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin-left: auto;
        }

        .refresh-btn:hover {
            background: #1d4ed8;
        }

        .refresh-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                width: 100%;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 12px 8px;
            }

            .investors {
                max-width: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>NYC Startup Funding Tracker</h1>
            <p>Real-time data on New York City startup funding rounds</p>
            <div class="last-updated" id="lastUpdated"></div>
        </div>
    </div>

    <div class="container">
        <div class="stats">
            <div class="stat-card">
                <span class="stat-number" id="totalRounds">-</span>
                <div class="stat-label">Total Rounds</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalFunding">-</span>
                <div class="stat-label">Total Funding</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="avgRound">-</span>
                <div class="stat-label">Avg Round Size</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="thisMonth">-</span>
                <div class="stat-label">This Month</div>
            </div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label>Round Type</label>
                <select id="roundFilter">
                    <option value="">All Rounds</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Industry</label>
                <select id="industryFilter">
                    <option value="">All Industries</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Search Companies</label>
                <input type="text" id="searchInput" placeholder="Search by company name...">
            </div>
            <div class="filter-group">
                <label>Min Amount ($M)</label>
                <input type="number" id="minAmount" placeholder="0" min="0">
            </div>
            <button class="refresh-btn" id="refreshBtn" onclick="loadData()">Refresh</button>
        </div>

        <div class="table-container">
            <div class="loading" id="loading">Loading funding data...</div>
            <div class="error" id="error" style="display: none;"></div>
            <table id="fundingTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Company</th>
                        <th>Round Type</th>
                        <th>Amount</th>
                        <th>Date</th>
                        <th>Investors</th>
                        <th>Industry</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let allData = [];
        let filteredData = [];

        // Change this to your actual domain when deployed
        const API_BASE_URL = window.location.origin;

        async function fetchFundingData() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/funding`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                return result;
            } catch (error) {
                console.error('Error fetching data:', error);
                throw error;
            }
        }

        function formatCurrency(amount) {
            const num = parseFloat(amount) || 0;
            if (num >= 1000000000) {
                return `$${(num / 1000000000).toFixed(1)}B`;
            }
            if (num >= 1000000) {
                return `$${(num / 1000000).toFixed(1)}M`;
            }
            if (num >= 1000) {
                return `$${(num / 1000).toFixed(0)}K`;
            }
            return `$${num.toLocaleString()}`;
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            try {
                return new Date(dateString).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
            } catch {
                return dateString;
            }
        }

        function populateFilters() {
            // Populate round type filter
            const roundTypes = [...new Set(allData.map(item => item.roundType).filter(Boolean))];
            const roundFilter = document.getElementById('roundFilter');
            roundFilter.innerHTML = '<option value="">All Rounds</option>';
            roundTypes.forEach(type => {
                roundFilter.innerHTML += `<option value="${type}">${type}</option>`;
            });

            // Populate industry filter
            const industries = [...new Set(allData.map(item => item.industry).filter(Boolean))];
            const industryFilter = document.getElementById('industryFilter');
            industryFilter.innerHTML = '<option value="">All Industries</option>';
            industries.forEach(industry => {
                industryFilter.innerHTML += `<option value="${industry}">${industry}</option>`;
            });
        }

        function updateStats() {
            const totalRounds = filteredData.length;
            const totalFunding = filteredData.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0);
            const avgRound = totalRounds > 0 ? totalFunding / totalRounds : 0;
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const thisMonthRounds = filteredData.filter(item => {
                if (!item.date) return false;
                const itemDate = new Date(item.date);
                return itemDate.getMonth() === currentMonth && itemDate.getFullYear() === currentYear;
            }).length;

            document.getElementById('totalRounds').textContent = totalRounds.toLocaleString();
            document.getElementById('totalFunding').textContent = formatCurrency(totalFunding);
            document.getElementById('avgRound').textContent = formatCurrency(avgRound);
            document.getElementById('thisMonth').textContent = thisMonthRounds.toString();
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            filteredData.forEach(item => {
                const row = document.createElement('tr');
                const websiteLink = item.website ? 
                    `<a href="${item.website}" target="_blank" class="company-website">${item.website.replace(/^https?:\/\//, '')}</a>` : '';
                
                row.innerHTML = `
                    <td>
                        <div class="company-name">${item.company}</div>
                        ${websiteLink}
                    </td>
                    <td><span class="round-type">${item.roundType}</span></td>
                    <td class="funding-amount">${formatCurrency(item.amount)}</td>
                    <td>${formatDate(item.date)}</td>
                    <td class="investors" title="${item.investors}">${item.investors}</td>
                    <td>${item.industry}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function applyFilters() {
            const roundFilter = document.getElementById('roundFilter').value;
            const industryFilter = document.getElementById('industryFilter').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const minAmount = parseFloat(document.getElementById('minAmount').value) || 0;

            filteredData = allData.filter(item => {
                const matchesRound = !roundFilter || item.roundType === roundFilter;
                const matchesIndustry = !industryFilter || item.industry === industryFilter;
                const matchesSearch = !searchInput || item.company.toLowerCase().includes(searchInput);
                const matchesAmount = (parseFloat(item.amount) || 0) >= (minAmount * 1000000);
                
                return matchesRound && matchesIndustry && matchesSearch && matchesAmount;
            });

            updateStats();
            renderTable();
        }

        async function loadData() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const table = document.getElementById('fundingTable');
            const refreshBtn = document.getElementById('refreshBtn');

            try {
                loading.style.display = 'block';
                error.style.display = 'none';
                table.style.display = 'none';
                refreshBtn.disabled = true;
                refreshBtn.textContent = 'Loading...';

                const result = await fetchFundingData();
                allData = result.data || [];
                filteredData = [...allData];

                // Update last updated time
                if (result.meta && result.meta.lastUpdated) {
                    const lastUpdated = new Date(result.meta.lastUpdated);
                    document.getElementById('lastUpdated').textContent = 
                        `Last updated: ${lastUpdated.toLocaleString()}`;
                }

                loading.style.display = 'none';
                table.style.display = 'table';
                
                populateFilters();
                updateStats();
                renderTable();
                
            } catch (err) {
                loading.style.display = 'none';
                error.style.display = 'block';
                error.innerHTML = `
                    <strong>Error loading data:</strong> ${err.message}<br>
                    <small>Make sure your backend API is properly configured with Airtable credentials.</small>
                `;
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = 'Refresh';
            }
        }

        // Event listeners
        document.getElementById('roundFilter').addEventListener('change', applyFilters);
        document.getElementById('industryFilter').addEventListener('change', applyFilters);
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('minAmount').addEventListener('input', applyFilters);

        // Load data on page load
        loadData();

        // Auto-refresh every 10 minutes
        setInterval(loadData, 10 * 60 * 1000);
    </script>
</body>
</html>
